# 1. Анализ потков данных

## 1.1. Финальное состояние (через 1 год)

### Схема потоков данных (TO-BE, финальное состояние)
```mermaid
flowchart TD
    A[Клиентский интерфейс оператора] -->|Медицинские данные, снимки| C[DWH]
    A -->|Финансовые данные, управление| I[Интеграционная платформа]
    C <-->|Данные| I
    I <-->|Медицинские данные| D[ИИ-сервисы]
    I <-->|Финансовые данные| E[Финтех-сервисы]
    I -->|Финансовые данные, инвентаризация, персонал| F[Внутренние сервисы]
    I -->|Данные для аналитики| J[Портал самообслуживания]
    C -->|Данные для аналитики| J
    J -->|Отчеты| B[BI-система]
    G[Старая интеграционная шина] -->|Ограниченные данные| F
    F -->|Ограниченные данные| G
```

#### Пояснения
- **Потоки данных**:
    - **Клиентский интерфейс оператора** отправляет медицинские данные в DWH, а финансовые и операционные (инвентаризация, персонал) — через интеграционную платформу.
    - **DWH** хранит все данные, синхронизируется с платформой и передает аналитические данные (финансовые, инвентаризационные, персонал, исключая медицинские карты и исследования) в портал самообслуживания.
    - **Интеграционная платформа** маршрутизирует данные между доменами, передавая медицинские данные в ИИ-сервисы, финансовые — в финтех-сервисы, операционные — во внутренние сервисы, аналитические — в портал.
    - **Портал самообслуживания** получает данные из DWH и платформы, формирует отчеты для бизнес-пользователей и передает их в BI-систему.
    - **Старая интеграционная шина** обслуживает устаревшие внутренние сервисы, имея входы и выходы через них.
    - **BI-система** использует отчеты от портала для аналитики.

- **Роль портала самообслуживания**:
    - Масштабируемый веб-портал для бизнес-пользователей, позволяющий запрашивать аналитические данные, конструировать отчеты и визуализировать дашборды.
    - Исключает медицинские данные, как требуется.
    - Поддерживает интеграцию новых бизнесов (фармацевтика, электроника).

#### Обоснования
- **Замена и сохранение легаси-систем**:
    - **DWH (Microsoft SQL Server 2008)**: Модернизирован до новой версии (например, SQL Server 2019) для повышения производительности. Модернизация быстрее полной замены (6 месяцев).
        - **Обоснование**: Устаревшая версия не справляется с аналитическими нагрузками.
    - **Интеграционная шина (Apache Camel)**: Заменена на платформу для масштабируемости и поддержки новых бизнесов. Старая шина сохранена для устаревших внутренних сервисов.
        - **Обоснование замены**: Camel не масштабируется и не поддерживает новые бизнесы. Платформа (6–9 месяцев) упрощает интеграции.
        - **Обоснование сохранения**: Устаревшие сервисы не успеют мигрировать за год.
        - **Роль платформы**: Маршрутизирует все основные потоки, включая аналитические данные для портала, обеспечивая масштабируемость.
    - **BI-система (Power BI)**: Сохранена, интегрирована с порталом через визуальный интерфейс.
        - **Обоснование**: Сохраняет инвестиции в BI-инфраструктуру.
    - **Клиентский интерфейс (Power Builder)**: Сохранен, так как замена требует переобучения и разработки, что выходит за год.
        - **Обоснование**: Минимизирует риски для операционных процессов.

- **Реалистичность**:
    - Внедрение платформы — 6–9 месяцев.
    - Разработка портала с аналитической СУБД — 9–12 месяцев.
    - Модернизация DWH — 6 месяцев.
    - Сохранение старой шины для устаревших сервисов не требует ресурсов.
    - Все элементы имеют входы и выходы.

- **Бизнес-ценность**:
    - Портал ускоряет аналитику для бизнес-пользователей.
    - Платформа упрощает интеграцию новых бизнесов.
    - Сохранение легаси-систем обеспечивает плавный переход.

## 1.2. Промежуточное состояние (через 2 месяца)

### Схема потоков данных (TO-BE, промежуточное состояние)
```mermaid
flowchart TD
    A[Клиентский интерфейс оператора] -->|Медицинские данные, снимки| C[DWH]
    A -->|Финансовые данные, управление| G[Интеграционная шина]
    C <-->|Данные| G
    G <-->|Медицинские данные| D[ИИ-сервисы]
    G <-->|Финансовые данные| E[Финтех-сервисы]
    G -->|Финансовые данные, инвентаризация, персонал| F[Внутренние сервисы]
    C -->|Данные для аналитики| B[BI-система]
    C -->|Данные для аналитики| H[Прототип витрины данных]
    H -->|Отчеты| B
```

#### Пояснения
- **Потоки данных**:
    - **Клиентский интерфейс оператора** отправляет медицинские данные (карты, снимки) в DWH для хранения, а финансовые данные и данные управления (инвентаризация, персонал) — через интеграционную шину для обработки финтех-сервисами и внутренними сервисами.
    - **DWH** хранит все данные, обменивается с шиной для синхронизации и передает аналитические данные (финансовые, инвентаризационные, персонал, исключая медицинские карты и исследования) в прототип витрины данных и BI-систему.
    - **Интеграционная шина** связывает домены (медицинский, финансовый, операционный), передавая медицинские данные в ИИ-сервисы, финансовые — в финтех-сервисы, операционные — во внутренние сервисы.
    - **Прототип витрины данных** получает аналитические данные из DWH, формирует отчеты для бизнес-пользователей и передает их в BI-систему, снижая нагрузку на DWH.
    - **BI-система** использует данные из DWH и прототипа для построения отчетов.

- **Роль прототипа витрины данных**:
    - Веб-портал самообслуживания для бизнес-пользователей, позволяющий запрашивать аналитические данные и конструировать отчеты через визуальный интерфейс.
    - Исключает медицинские данные, как требуется.
    - Тестирует концепцию витрины и ускоряет доступ к аналитике.

#### Обоснования
- **Сохранение легаси-систем**:
    - **DWH (Microsoft SQL Server 2008)**: Сохранен из-за невозможности замены за 2 месяца (сотни терабайт данных, сложная миграция). Оптимизация (индексация, партиционирование) поддерживает прототип витрины.
    - **Интеграционная шина (Apache Camel)**: Сохранена, так как замена требует 6–9 месяцев. Шина поддерживает текущие интеграции и новые маршруты для финансовых данных.
    - **BI-система (Power BI)**: Сохранена, интегрируется с прототипом через визуальный интерфейс, удовлетворяет бизнес-потребности.
    - **Клиентский интерфейс (Power Builder)**: Сохранен, так как замена требует переобучения операторов и разработки, что нереально за 2 месяца.
    - **Роль шины**: Используется для всех потоков, включая клиентский интерфейс и DWH, чтобы сохранить совместимость с текущими процессами финтех- и внутренних сервисов.

- **Реалистичность**:
    - Прототип витрины реализуем за 2 месяца с использованием существующих технологий.
    - Оптимизация DWH и настройка маршрутов в шине — 1–1,5 месяца.
    - Все элементы имеют входы и выходы.

- **Бизнес-ценность**:
    - Прототип витрины решает проблему долгих отчетов.
    - Сохранение легаси-систем минимизирует риски.
    - Шина обеспечивает быстрые изменения в потоках данных.

## 2. Диаграммы компонентов

### 2.1. Текущее состояние (AS-IS)
![](//www.plantuml.com/plantuml/png/jLPRQnj757xNhvZgoGRB2YKF9K-ndTAgEA1M3NqK8sbiBQnsnUxAnfI2vKkTee3RlDIKabwQlcziAr7aMluBC_-etvczU6Urjg0b6ApTsNFvpdSkPnxx0VU2GSykVMGvRNlG4QmR17t_KRNgyTtLRIle3be3NtXjrmc44wostLwrRtE7T2f-qB6jLdNZOQLEHy-URbPxt0-4XwFc1ZIuvGXljK_sIu4Ls8B9FzIn7Cj_PCWs7ZvYya-yJDMX-W6_OwQ6SgQ6wW3_J-MrdE1eQQrHgJLM66JsvKoUG-vQlM1oYfThI8xbUqYEeu_BfL9TUBxhBBbzuV70zLPOMRwIDreWr8RtotJs4fPcyb9Er07PkY9VP0y8fjelleNo6aSZEIul9sR11KBo_IPnGdP-Wl0x3M1OWPkPl58lS410Gq97xzhXQtADk2TgNnr276vdS7T2Zse43wN67gZhDTVTWTFXtjvIsxR0UDC2yTuMRmkoyiiSqlSC_pGHC7n4TAWXJ9iXox2ypBujCPOc9R4-i63sMOt96qXDO7qctv9zyaAuw-wkyDZwmB8xmjE1dCrxkqIKfqoUnvo6376EDRdVQt0QgJf64e_eNOPqHXof4KwpQ4b-HhJJbpG7z0A6lfkZgBFRRVhw3CYUVFDvFiedBItIQKMf2f6PqBIA3q-jjkVwxbR06bzkieRmTX3nnmyUVAB3_Hku84w5KXYM71U5HQV5OSsNLWQlHYi26uu__NgpefCoWpQg2tyZ0WICrKQZreXpyGwSN-7xIP8qe3c884FZA2uwZK2T0XC8a1TKWdYQviamiVH4m3iyu4qVVIGCBgWAgMKr8wY6CCyfKD9FqkrgP3X2oKO55m8z6TCuTES3s8qC2vFTicvplLwhWEe9QP3zWlg6DE_t8z45nLsB9m8w6Uv3oE4fuOomfZnEuXaKHZOoBKp7XQYfVRSnYYpNQM9wP3f8NfYr8KDuKy-fb0hYWMxJHsrQRQ69rPLrJXGmYXyfVKvfXU4Kl9nGO6jztkuAji5xmjQ1_bei3UTcZf1Qq7Mf3caifzvaI3paIiM7XnvlUcBRyWDlZxpyJWDTPtGV-b4PPE2ixNXkH7jC-6KXYa9AkPKm4TDvLiaYLACvyg3Hzrp8-yb6UAEhxqsSm8cSpes5-bxGTHsDyKUSnsLnnsXR37gB2g7TDP2_JaVtyO88KdNUjuZ4UirG89IVkTZ1szKl-0wF5ixyJCgFf0cAEp-DYYlOSxXjG7y9XKDABlLJt0qBGaZjt1q3gePcD4sNatXOHlJ0mqptxqLIrlAlT89S9JsTR79wcKQ5QWxdv4oVd4TxbBeXqpDOQPg5qbV2pjmYikjIdi5IkkkZRLxMQnIQf9OHphNjA_XBOQjJEVv0MqNp6yCnglz_8BhRWrcTYntCXROW0BDo5jl_BoGPLdFpp9nJwGtk7cjv0tdGlr7Z93lFf6QOhCnxyANNXEBmyxXmbuYjf8hcSYygQXFCoeA5hNV-d9VRozVFwRtZhGmBGPhgf9Mky7leqZPqPcYNqIusohNOWNcBJ_qikgIdFLvwB9pEe6V_2m00)
```plantuml
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

title Схема C4: Текущее состояние (AS-IS, уровень контейнеров)

Person(operator, "Оператор", "Вводит клиентские данные")
Person(business_user, "Бизнес-пользователь", "Формирует отчеты")

System_Boundary(client_interface, "Клиентский интерфейс оператора") {
  Container(client_ui, "UI приложение", "Power Builder", "Интерфейс для ввода медицинских, финансовых, операционных данных")
}
System_Boundary(dwh_system, "DWH") {
  ContainerDb(dwh_db, "База данных", "Microsoft SQL Server 2008", "Хранит медицинские, финансовые, операционные данные")
  Container(dwh_etl, "ETL-процессы", "SQL/SSIS", "Извлечение, трансформация, загрузка данных")
  Container(metadata_store, "Хранилище метаданных", "SQL", "Схемы данных и правила доступа")
}
System_Boundary(bi_system, "BI-система") {
  Container(bi_app, "BI-приложение", "Power BI", "Визуализация и формирование отчетов")
}
System_Boundary(integration_bus, "Интеграционная шина") {
  Container(bus_service, "Сервис маршрутизации", "Apache Camel", "Маршрутизация данных между сервисами")
  Container(schema_registry, "Реестр схем", "Apache Avro", "Валидация данных")
}
System_Boundary(ai_services, "ИИ-сервисы") {
  Container(ai_processor, "Обработчик данных", "Python", "Анализ медицинских данных")
}
System_Boundary(fintech_services, "Финтех-сервисы") {
  Container(fintech_api, "API-сервис", "Golang/Java", "Финансовые операции и данные")
}
System_Boundary(internal_services, "Внутренние сервисы") {
  Container(internal_api, "API-сервис", "Различные технологии", "Управление клиниками, финансами, инвентаризацией")
}

Rel(operator, client_ui, "Использует", "UI")
Rel(client_ui, bus_service, "Отправляет медицинские, финансовые, операционные данные", "API")
Rel(ai_processor, bus_service, "Отправляет медицинские данные", "API")
Rel(fintech_api, bus_service, "Отправляет финансовые данные", "API")
Rel(internal_api, bus_service, "Отправляет операционные данные", "API")
Rel(bus_service, schema_registry, "Валидирует данные", "API")
Rel(schema_registry, bus_service, "Предоставляет схемы", "API")
Rel(bus_service, dwh_etl, "Отправляет данные", "ETL")
Rel(dwh_etl, metadata_store, "Использует схемы, правила доступа", "SQL")
Rel(dwh_etl, dwh_db, "Загружает данные", "SQL")
Rel(dwh_db, bi_app, "Предоставляет аналитические данные", "SQL")
Rel(business_user, bi_app, "Формирует отчеты", "UI")

@enduml
```

#### Описание
- **Компоненты**:
    - **Клиентский интерфейс**: UI-приложение (Power Builder) для ввода медицинских, финансовых и операционных данных оператором.
    - **DWH**: База данных (SQL Server 2008) хранит все данные, ETL-процессы (SSIS) трансформируют данные, хранилище метаданных (SQL) управляет схемами.
    - **BI-система**: BI-приложение (Power BI) формирует отчеты.
    - **Интеграционная шина**: Сервис маршрутизации (Apache Camel) передает данные, реестр схем (Apache Avro) валидирует схемы.
    - **ИИ-сервисы**: Обработчик (Python) анализирует медицинские данные.
    - **Финтех-сервисы**: API-сервис (Golang/Java) управляет финансами.
    - **Внутренние сервисы**: API-сервис (различные технологии) управляет клиниками и инвентаризацией.
- **Потоки данных**:
    - Оператор через UI отправляет медицинские, финансовые, операционные данные в шину.
    - Сервисы (ИИ, финтех, внутренние) отправляют данные через шину, валидируя в реестре схем, в ETL-процессы DWH.
    - ETL-процессы используют метаданные и загружают данные в базу DWH.
    - DWH передает аналитические данные (исключая медицинские карты и исследования) в BI-приложение по запросам.
    - Бизнес-пользователь формирует отчеты через BI-приложение.

### 2.2. Финальное состояние (через 1 год)
![](//www.plantuml.com/plantuml/png/jLXRRzl64dxNh-3HKmBOqSb1NawUSk849suJr8qQz56Wf9NCXY85aefX50LyYPka3f0sA52ZA986IT_fYsp55_alBFzHlnckQQvM30qZXG4bNEvyyyrbPdTuAupi81hqtCg_7A_b3jh2MeoYVdYpLWlifMjT9reSD0UX25g-5malkjRoUxM-QtiaCnj6RTTfrkPkp2xGqgC7zsizEun4WAN672HinnF1jJxXLo8dSeKbtoKRSYYFPMpDtRXfoGzo94zaB8-Ib_XtB8TMiYh7oMgoXjzNM1fXwKhoJ0wJ5SWTMDSjkOjzUpDMiewbiTp1yadoqfA7U3Y1t51-XDmmVNcrKbaGGUXxL_o-2Ep83sQigdmZJtb3p6fMghJs6aZ0bQDaZR2EI3FXWSyXiy2xM9vWQLCEgrVFOE4T61c63NY9iN_1vWCci3eBDMCsxO29nimEpwpm0wcMnr2uagnZEzJ6gI-80r0EatLBZYniMoC7u7SJUYlrPRYurxZj3xos7InVQRaE8jDm4A2WOxS4OVzkyFy8gDGzKFUKd9Ii0bftX8ohLwtlAvQL1UyCVU00zj6y9K-nQmJqiTmdVD92rYpuIoAmRWySjoq2Dc_BrBO7srzPSaTvEhPW_P1T_YEJOwR91aBxLAK5riXpoIPMSsnv_vY3WJTPPEW17lh1S55xQR4HyXgOtVdstgILTvgyfTrC0nWZNh6EYXSFd5RWXtudikfVtxVg8dW2Y__px-l_PNF_8bxOZj1DDKiEfvc5rGApp8JByMMs8dAX-EutzsSvA6D88-Vmjqc4mB5Mhy_NLImEuFCZl7z6GLDirbBAa7YgKf4P9A_02GwGkvoO1s2lEsE2Iqz4TjkEx4Q8wXAQBpYLNyWXUmJP46imAKicgBf2igafukm_PR0T1cCUt1r0x5J6KuFTTCvZVNj-5guUaGJXc_bDk-r-FzrQajppga-Wlg6UwnJUKJuZhfaVHwepnIb6heHfUIhhKBYTHeYaSbgYqVU3o7P9srj2PCyTKMUC0Jx6tpR-VmGI-u1dDKJ1i2s5OVkO-51kmyPpHBBd2_k9NQlt0yVhbfJjH7EYs6oNzZh2WBrQhIbUgjn-piEoawXUOjBuJhv7DVxAYUBvIntNVYpCOkD4XPvTpUsgXEAfwADFLrSexA250lEwU5HHW3GaLTL-X3Idv3uM3edINHS7dzDA9QkQZ4MUAMPod6ToFC64wwg57zVlfdqzJaC7y5sZGzt1ndk3fgv-nd81PNS5dPXPDHsf_9vMcfJ0KtEKZfXkO4UExpLm2OWwVj3BvOpSrPjO6iHJw09fLHjJIt0GdcK-zm9kXZl4tgBzICNdr8cW8git4CJMB-tEOvkj_MFwDkZN-mbiHSpsadKgfamDbzLeCWbQYw9dDmBHTS8eM2OjVq8QOQF62VcqPP5w27NSWV1mCh2GzL09fGr3jOgzgPoCul2RtubMnCsKWiQtbUta9-WwX6dgZhGnsM7J0ygR_sh6-b_V1WjhlYMQ8kXgzQ9Y3l9GlMASdLYtE1Ms6VPPcWpMUUYuVnsNvWO2oe4aBDBCtV4JEP8yfzTJCiDtsurBPuVomvpT4svfad2Bm_gguZoKEyGgsT0IfR1xsyuPnp0jYAtPl5ooQPW6YNxWOt_e1oh87AHjTLQWmnhrlR0SBVfULUkQyg3W5bL-A-fGp5gB6lCFsIrneyI2JDpkE-JjXNbDW5Z-ttTjhrkZ8wRAuERrP_BsCqAcwAsvADa2ptOrwgyXWC1oy4vKefUOaE4Ksu2YntKmLmy0PVTmAN8VFaiu-TvihsgKu8V3jCzCt0FL6g_mBACoCCjFFaB92vM7misDCVcRkTm2KdO0f-D4bM_ia2IntEQ9Wde3VHbjZ5p3V-W2o_vLTFJilpoZOWrwTfOhC4mhCK3Fd7ByopX9GvquZhI39Jz25g8P01EattBXgEkrHXqBwdR-2NxciVKEKEgSoe3IO-VYLgivfy2f1Wg68OMYqyc0IWqjvvSXcNEFKOIQysPAPXar3areEPzBVyj6idqP6-ORuYobtn-BIuiTKMYoxipFXPfD0PyBK4V9u8sOby9cLsODNnkdD7JSVrLdoXKYkZVRG2hriLOFLGv9ZpKxWAz6EohU5vrc5BvPJnTqIhcYadZgW-TRYBEcqhJDonb367bvZw_1gmKDBnjLJxDvBTOvQg06pq9_y0jKD5KslQ9FSOLQD3ECr3OZMvRS9cRJAN2jzgrGazU_KsgM5vCoFaTgLmeDqJHqAtbXHhjONXbbV1WrpD8mZ051FvUdEOXwA3FYlBx0CQn36XgDRdKPFPLRmciFUkxV)
```plantuml
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

title Схема C4: Финальное состояние (через 1 год, уровень контейнеров)

Person(operator, "Оператор", "Вводит клиентские данные")
Person(business_user, "Бизнес-пользователь", "Формирует аналитику и отчеты")

System_Boundary(client_interface, "Клиентский интерфейс оператора") {
  Container(client_ui, "UI приложение", "Power Builder", "Интерфейс для ввода медицинских, финансовых, операционных данных")
}
System_Boundary(dwh_system, "DWH") {
  ContainerDb(dwh_db, "База данных", "Microsoft SQL Server 2019", "Хранит медицинские, финансовые, операционные данные")
  Container(dwh_etl, "ETL-процессы", "SQL/SSIS", "Извлечение, трансформация, загрузка данных")
  Container(metadata_store, "Хранилище метаданных", "SQL", "Схемы данных и правила доступа")
}
System_Boundary(bi_system, "BI-система") {
  Container(bi_app, "BI-приложение", "Power BI", "Визуализация и формирование отчетов")
}
System_Boundary(self_service_portal, "Портал самообслуживания") {
  Container(portal_app, "Веб-портал", "Java/Spring", "Интерфейс для аналитики бизнес-пользователей")
  ContainerDb(portal_db, "Аналитическая СУБД", "Snowflake", "Хранит агрегированные аналитические данные")
  Container(search_engine, "Поисковый движок", "Elasticsearch", "Поиск по аналитическим данным")
  Container(data_catalog, "Каталог данных", "DataHub", "Поиск, lineage, управление метаданными")
}
System_Boundary(integration_platform, "Интеграционная платформа") {
  Container(bus_service, "Сервис маршрутизации", "Kafka", "Маршрутизация данных между сервисами")
  Container(schema_registry, "Реестр схем", "Confluent Schema Registry", "Валидация данных")
  ContainerDb(object_storage, "Объектное хранилище", "MinIO, Apache Iceberg", "Хранение сырых данных с табличным форматом")
}
System_Boundary(integration_bus, "Старая интеграционная шина") {
  Container(old_bus_service, "Сервис маршрутизации", "Apache Camel", "Маршрутизация для устаревших сервисов")
}
System_Boundary(ai_services, "ИИ-сервисы") {
  Container(ai_processor, "Обработчик данных", "Python", "Анализ медицинских данных")
}
System_Boundary(fintech_services, "Финтех-сервисы") {
  Container(fintech_api, "API-сервис", "Golang/Java", "Финансовые операции и данные")
}
System_Boundary(internal_services, "Внутренние сервисы") {
  Container(internal_api, "API-сервис", "Различные технологии", "Управление клиниками, финансами, инвентаризацией")
}

Rel(operator, client_ui, "Использует", "UI")
Rel(client_ui, bus_service, "Отправляет медицинские, финансовые, операционные данные", "API")
Rel(ai_processor, bus_service, "Отправляет медицинские данные", "API")
Rel(fintech_api, bus_service, "Отправляет финансовые данные", "API")
Rel(internal_api, bus_service, "Отправляет операционные данные", "API")
Rel(bus_service, schema_registry, "Валидирует данные", "API")
Rel(schema_registry, bus_service, "Предоставляет схемы", "API")
Rel(bus_service, object_storage, "Сохраняет сырые данные", "API")
Rel(bus_service, dwh_etl, "Отправляет данные", "ETL")
Rel(object_storage, dwh_etl, "Предоставляет сырые данные", "API")
Rel(dwh_etl, metadata_store, "Использует схемы, правила доступа", "SQL")
Rel(dwh_etl, dwh_db, "Загружает данные", "SQL")
Rel(dwh_db, data_catalog, "Отправляет метаданные", "API")
Rel(object_storage, data_catalog, "Отправляет метаданные", "API")
Rel(portal_db, data_catalog, "Отправляет метаданные", "API")
Rel(data_catalog, portal_db, "Предоставляет метаданные, lineage", "API")
Rel(portal_app, portal_db, "Инициирует запросы данных", "SQL")
Rel(portal_db, dwh_db, "Запрашивает аналитические данные", "SQL")
Rel(bus_service, portal_db, "Предоставляет аналитические данные", "API")
Rel(portal_db, portal_app, "Передает данные", "SQL")
Rel(portal_app, search_engine, "Индексирует данные для поиска", "API")
Rel(search_engine, portal_app, "Предоставляет результаты поиска", "API")
Rel(portal_app, data_catalog, "Запрашивает метаданные", "API")
Rel(portal_app, bi_app, "Передает отчеты", "API")
Rel(business_user, portal_app, "Запрашивает аналитику", "UI")
Rel(business_user, data_catalog, "Ищет данные", "UI")
Rel(business_user, bi_app, "Формирует отчеты", "UI")
Rel(old_bus_service, internal_api, "Передает ограниченные данные", "API")
Rel(internal_api, old_bus_service, "Отправляет ограниченные данные", "API")

@enduml
```

#### Описание
- **Компоненты**:
    - **Клиентский интерфейс**: UI-приложение (Power Builder) для ввода данных.
    - **DWH**: База данных (SQL Server 2019) хранит данные, ETL-процессы (SSIS) трансформируют данные, хранилище метаданных (SQL) управляет схемами.
    - **BI-система**: BI-приложение (Power BI) для отчетов.
    - **Портал самообслуживания**: Веб-портал (Java/Spring) для аналитики, Snowflake (аналитическая СУБД) хранит агрегированные данные, Elasticsearch (поисковый движок) ускоряет поиск, DataHub (каталог данных) управляет метаданными.
    - **Интеграционная платформа**: Kafka (маршрутизация) передает данные, Confluent Schema Registry валидирует схемы, MinIO с Apache Iceberg хранит сырые данные.
    - **Старая интеграционная шина**: Apache Camel для устаревших сервисов.
    - **ИИ-сервисы**, **Финтех-сервисы**, **Внутренние сервисы**: Как в AS-IS.
- **Потоки данных**:
    - Оператор отправляет медицинские, финансовые, операционные данные через платформу (Kafka).
    - Сервисы (ИИ, финтех, внутренние) отправляют данные через платформу, валидируя в реестре схем, в MinIO (Iceberg) и ETL-процессы DWH.
    - MinIO передает сырые данные в ETL-процессы.
    - ETL-процессы используют метаданные DWH и загружают данные в базу DWH.
    - Snowflake запрашивает исторические аналитические данные (финансовые, операционные, исключая медицинские) из DWH через SQL и получает потоковые данные от Kafka через API.
    - Веб-портал инициирует запросы к Snowflake, которая передает данные для аналитики.
    - Snowflake, MinIO и DWH отправляют метаданные (схемы, доступ, lineage) в DataHub, который предоставляет их порталу.
    - Веб-портал индексирует данные в Elasticsearch, передает отчеты в BI-приложение.
    - Бизнес-пользователь запрашивает аналитику через веб-портал, ищет данные в DataHub, формирует отчеты через BI.
    - Устаревшие сервисы обмениваются данными через старую шину.

#### Обоснования
- **Соответствие финальному состоянию**: Схема отражает переход к **Data Mesh** и **Data Lakehouse**:
    - **Data Mesh**: Домены (Медицинский, Финансовый, Операционный, Аналитический) автономны благодаря локальным хранилищам (в доменах) и платформе (Kafka). Портал — продукт данных, DataHub — единый каталог, обеспечивающий поиск, lineage, комплаенс.
    - **Data Lakehouse**: MinIO с Iceberg (объектное хранилище, табличный формат) хранит сырые данные, Snowflake обрабатывает аналитические, поддерживая гибрид структурированных/неструктурированных данных.
- **Схема потоков**:
    - Клиентский интерфейс отправляет медицинские данные в DWH, финансовые/операционные — через платформу (ранее шину).
    - Snowflake (аналог прототипа витрины) запрашивает аналитические данные из DWH и получает потоковые данные от Kafka.
    - DataHub собирает метаданные, заменяя локальные хранилища метаданных портала.
- **Объектное хранилище**: MinIO в интеграционной платформе хранит сырые данные (логи, транзакции), разгружая DWH, которое фокусируется на архивации. Iceberg обеспечивает транзакции и версионирование, поддерживая **Data Lakehouse**. Размещение в платформе упрощает потоковую обработку через Kafka.
- **Реестр схем**: Confluent Schema Registry валидирует схемы данных в Kafka, обеспечивая согласованность при передаче в MinIO, DWH или Snowflake, что критично для **Data Mesh**.
- **Snowflake и DWH**: Snowflake запрашивает исторические данные из DWH через SQL для глубокого анализа, а Kafka предоставляет потоковые данные для реального времени, поддерживая оперативную и долгосрочную аналитику в **Data Lakehouse**.
- **DataHub**: Централизует метаданные от DWH, MinIO, Snowflake, обеспечивая поиск, lineage, комплаенс, как в **Data Mesh**.
- **Реалистичность**: Внедрение Kafka, MinIO, Iceberg (6–9 месяцев), Snowflake, Elasticsearch, DataHub (9–12 месяцев) возможно за 1 год, учитывая ресурсы компании (ИТ-отдел, серверы для сотен терабайт).
- **Бизнес-ценность**: Портал ускоряет аналитику, платформа и MinIO поддерживают новые бизнесы, DataHub упрощает поиск данных, медицинские данные исключены из аналитики, DWH разгружен для архивации.


### 2.3. Промежуточное состояние (через 2 месяца)
![](//www.plantuml.com/plantuml/png/jLXDRzj64xxhL-ohKm9OKH3ay2Ad94xHkaW0jshGeq1BZCM28WMIYc4K1ImvJbqeXTfSQWH5Fj3qJd_GLkpQ_Wkx_wZpx40qkQHAm4LFWPOxpppppCUESp-Ch20QzjtQ_nolumwxjkX5qI2yrsm6riQjTIVg3TU6eHrqV2-olUXMn-yt1wxbmQOHHbtNMMiktssiukZfayVDlXL6Ta17xMMoi1pF3cuDW5-BdCYrXVoWTcGY_vAnMBvxJyXtQajUqCz47gjjDPONwaTvJYU9K2FwCT97KpgQqT4D-fYGGI9Fn1q1AxemLIzbl2J86aW7zF5SlHBob7wSatKYFv5rmXzlrcghTX3wtWr_O0TMv0TBeYxVoajz8TREjkeuUoqFoE18pjGOM6Vm3pnYTQgvqBTOdjFHH2RrctDOqef23iCsD0FEhtJvH1CODSZDXJnJh-W0HE4kmM_jy2DSKqWpjQMsPGAtm8_XcYxEvAdQ5d8cwDfOop1M4_9RQssIuFtsGt_eTQrWyqR7TIXFROVI5JopEZQmtnJuVo8ebeVSlO18QaJGUI5aNByflgy9aQPoZZvq2FRfYf2NT6icpyZo6FZmWcXM_Gqx40-7Zjkr0ntUNj7R4SK-5IG4AnthX6h9Nu8SCrKxIu9CPf02Pr1EJN2QOOlx5qW6lgIPmGzIw8U2HDsDNZlKPyJiqRTVc54-MjDNkckSm9Zo5UTHwSCJfnFueVyi4gsl7ekM7JodYE_Sllr_7UwVu0KzrBWqB9cKXONJyh2A1PVXgzdQaKkEF_lcSKCdvOAiqHqZDG4XujXijLPQd0iAw82Ibg2EG5Ap6JDbidZ1fSWCr9GuaG3oK1VcYJmrn32uzEt8wbgHrGwfk-oS5hgKVv89T-vOneQcO8b_vZD2JNAETFLVQh033GOUF2E8sAMCIvEzvbpb-k5AWwIUmGBunVh6RMimuAiLnRt2SmBzJUvrdq8drWnSMKTkQMvuniYqC8vBMMi5-pIQsuF0Z_neSm0fULh2J4-4Im4Xa3WKag6M6Le6KaS8wedSfoZ1KcVZJ4Ut6VLyh_deEyjRzojQrnXGoCz-vRm31iLiz5jAZhlkZVfPxOho-Z2wIrScWHvcTUOsCHX2yqNpkrofUJ73wUzcpSh4q3zByO-qKX4mvrsDvcyVYW8bagrVF8CcO5bfOBAlqzlb-5wRdfjCXY14Tcp8c9AaTe5LKkfasmvfR3dyHdn0XhNxaG15IlSkEfw0qxgMCyJsO61rUhPOjlgsMzVAbDzMKwDzzIilZzGsAN7bZTKmKX2IXxxL3knr9uo2JNXvBnEa3-gaIcReF7WU-DoHd72uBc5HAgdbp9LWEULU8yjGJKpno0ADIVV3-GgnhzEzpxsDRiYxJJjBS_o5on9QBNZrgaa_Go5qUZdc7zDNVQSYWjJS6ZWGSNKbPm2Md_ikpO3cbzPpYpUKudDblbOeQhEpoYiuy2mtH_qr6MmZkRfTk64gGaXn5iSWt-ld-qmtF_SiowENJ8psGz1UsBAy-kaVfroe-NTxVgPFUFSSenioFODn1nLgNzjkPktCRb9oZv3IOSdhNrrlM6G9iypbgytaBRbA6QifZ4gBoHnsFAMAoCP0A8F_DokBpj0y88wYuFCTh_UmWpy30ElDd7VECDr_2gmhKB9jR92vfhv6e9askxx2Y-6D5gZ6lqwkSgZcOCuEtCpVBelH2W1c2N01yBkObsOqNmlpY6dsYwkdqLS6p5B5EicDOdZ9DE1lwLPyN5wlXZcip4LdORWLkqk56zvZ_mC7UVxcJbbiu6eWDYtkNCP8DeeW7Rp61lMFJg1AAS_CIcvKb_aNlO78HQ19waKBosVvt-uypyj1cLVv_mAOp3H6xRxjTOTzzsy0)
```plantuml
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

title Схема C4: Промежуточное состояние (через 2 месяца, уровень контейнеров)

Person(operator, "Оператор", "Вводит клиентские данные")
Person(business_user, "Бизнес-пользователь", "Формирует аналитику и отчеты")

System_Boundary(client_interface, "Клиентский интерфейс оператора") {
  Container(client_ui, "UI приложение", "Power Builder", "Интерфейс для ввода медицинских, финансовых, операционных данных")
}
System_Boundary(dwh_system, "DWH") {
  ContainerDb(dwh_db, "База данных", "Microsoft SQL Server 2008", "Хранит медицинские, финансовые, операционные данные")
  Container(dwh_etl, "ETL-процессы", "SQL/SSIS", "Извлечение, трансформация, загрузка данных")
  Container(metadata_store, "Хранилище метаданных", "SQL", "Схемы данных и правила доступа")
}
System_Boundary(bi_system, "BI-система") {
  Container(bi_app, "BI-приложение", "Power BI", "Визуализация и формирование отчетов")
}
System_Boundary(data_mart_prototype, "Прототип витрины данных") {
  Container(data_mart_app, "Веб-портал", "Python/Django", "Интерфейс для аналитики бизнес-пользователей")
  ContainerDb(data_mart_db, "Кэш данных", "SQL", "Хранит агрегированные аналитические данные")
  Container(data_mart_metadata, "Метаданные витрины", "SQL", "Управление схемами и доступом витрины")
}
System_Boundary(integration_bus, "Интеграционная шина") {
  Container(bus_service, "Сервис маршрутизации", "Apache Camel", "Маршрутизация данных между сервисами")
  Container(schema_registry, "Реестр схем", "Apache Avro", "Валидация данных")
}
System_Boundary(ai_services, "ИИ-сервисы") {
  Container(ai_processor, "Обработчик данных", "Python", "Анализ медицинских данных")
}
System_Boundary(fintech_services, "Финтех-сервисы") {
  Container(fintech_api, "API-сервис", "Golang/Java", "Финансовые операции и данные")
}
System_Boundary(internal_services, "Внутренние сервисы") {
  Container(internal_api, "API-сервис", "Различные технологии", "Управление клиниками, финансами, инвентаризацией")
}

Rel(operator, client_ui, "Использует", "UI")
Rel(client_ui, dwh_db, "Отправляет медицинские данные", "SQL")
Rel(client_ui, bus_service, "Отправляет финансовые, операционные данные", "API")
Rel(dwh_db, bus_service, "Передает данные", "ETL")
Rel(bus_service, dwh_etl, "Отправляет данные", "ETL")
Rel(ai_processor, bus_service, "Отправляет медицинские данные", "API")
Rel(fintech_api, bus_service, "Отправляет финансовые данные", "API")
Rel(internal_api, bus_service, "Отправляет операционные данные", "API")
Rel(bus_service, schema_registry, "Валидирует данные", "API")
Rel(schema_registry, bus_service, "Предоставляет схемы", "API")
Rel(dwh_etl, metadata_store, "Использует схемы, правила доступа", "SQL")
Rel(dwh_etl, dwh_db, "Загружает данные", "SQL")
Rel(dwh_db, data_mart_db, "Предоставляет аналитические данные", "SQL")
Rel(dwh_db, bi_app, "Предоставляет аналитические данные", "SQL")
Rel(data_mart_db, data_mart_app, "Передает данные", "SQL")
Rel(data_mart_app, data_mart_metadata, "Управляет схемами, доступом", "SQL")
Rel(data_mart_app, bi_app, "Передает отчеты", "API")
Rel(business_user, data_mart_app, "Запрашивает аналитику", "UI")
Rel(business_user, bi_app, "Формирует отчеты", "UI")

@enduml
```
#### Описание
- **Компоненты**:
    - Как в AS-IS, плюс **прототип витрины данных**: Веб-портал (Python/Django) для аналитики, кэш данных (SQL) для агрегированных данных, метаданные витрины (SQL) для схем и доступа.
- **Потоки данных**:
    - Оператор отправляет медицинские данные в DWH, финансовые и операционные — в шину.
    - DWH передает данные в шину через ETL для синхронизации.
    - Сервисы (ИИ, финтех, внутренние) отправляют данные через шину, валидируя в реестре схем, в ETL-процессы DWH.
    - ETL-процессы используют метаданные DWH и загружают данные в базу.
    - DWH передает аналитические данные (исключая медицинские карты и исследования) в кэш витрины и BI-приложение по запросам.
    - Веб-портал витрины получает данные из кэша, управляет доступом через метаданные витрины, передает отчеты в BI-приложение.
    - Бизнес-пользователь запрашивает аналитику через веб-портал и отчеты через BI.

#### Обоснования
- **Соответствие промежуточному состоянию**: Введен прототип витрины как первый шаг к **Data Mesh** (продукт данных), разгружающий DWH. Потоки соответствуют схеме: медицинские данные в DWH, финансовые/операционные через шину, аналитические данные в витрину и BI.
- **Data Mesh**: Прототип витрины — продукт данных аналитического домена, метаданные витрины обеспечивают автономность, но без полноценного каталога данных.
- **Data Lakehouse**: Частичное соответствие, так как SQL кэш — шаг к структурированным данным, но нет объектного хранилища.
- **Реалистичность**: Внедрение прототипа (Python/Django, SQL) и оптимизация DWH возможны за 2 месяца.
- **Бизнес-ценность**: Прототип ускоряет аналитику, снижает нагрузку на ИТ, поддерживает переход к финальному состоянию.

## 3. Проблемы текущей архитектуры с приоритетами их решения

| **Проблемное место** | **Описание проблемы (для бизнеса)** | **Влияние на бизнес** | **Технические аспекты (для инженеров)** | **Приоритет (MoSCoW)** |
|----------------------|------------------------------------|-----------------------|-----------------------------------------|------------------------|
| **Долгое время формирования отчетов** | Отчеты для принятия решений (например, по финансам или инвентаризации) формируются часами, что замедляет работу менеджеров и аналитиков. | Задержки в принятии решений, снижение конкурентоспособности, упущенные возможности из-за отсутствия оперативной аналитики. | DWH (SQL Server 2008) перегружен из-за больших объемов данных (сотни терабайт) и сложных трансформаций в ETL-процессах (SSIS). Отсутствие кэширования и оптимизации запросов. | **Must have** |
| **Устаревшая интеграционная шина** | Система обмена данными между сервисами (ИИ, финтех, клиники) не справляется с ростом компании, что усложняет добавление новых бизнесов, таких как фармацевтика. | Ограничения в расширении бизнеса, высокие затраты на интеграцию новых систем, риск сбоев в обмене данными. | Интеграционная шина (Apache Camel) не масштабируется, не поддерживает событийно-ориентированную архитектуру, имеет ограниченную пропускную способность. | **Should have** |
| **Ограниченное управление метаданными** | Нет единой системы, которая бы четко описывала, какие данные где хранятся и как их использовать, что затрудняет аналитику и контроль доступа. | Риск ошибок в отчетах, сложности с соблюдением требований к конфиденциальности данных, лишние затраты на ручную проверку данных. | Хранилище метаданных в DWH (SQL) минимально, нет централизованного каталога данных или инструментов для управления схемами и доступом. Реестр схем (Avro) ограничен валидацией. | **Could have** |
| **Устаревший DWH** | Центральное хранилище данных работает на старом программном обеспечении, что замедляет обработку и увеличивает риск сбоев. | Низкая производительность аналитики, потенциальные убытки из-за простоев, невозможность быстро адаптироваться к новым требованиям. | SQL Server 2008 устарел, не поддерживает современные оптимизации (например, columnstore индексы), имеет низкую производительность при больших нагрузках. | **Must have** |
| **Отсутствие портала самообслуживания** | Бизнес-пользователи зависят от аналитиков для получения отчетов, что замедляет доступ к данным и увеличивает нагрузку на ИТ-отдел. | Задержки в принятии решений, высокая стоимость поддержки аналитиков, ограниченная гибкость в анализе данных. | Нет веб-портала для самостоятельной аналитики, вся нагрузка ложится на DWH и BI-приложение (Power BI), что усугубляет перегрузку. | **Must have** |
| **Устаревший клиентский интерфейс** | Интерфейс для операторов в клиниках сложен в использовании и несовместим с современными технологиями, что снижает эффективность работы. | Замедление операционных процессов, необходимость переобучения персонала, риск ошибок при вводе данных. | Power Builder устарел, не поддерживает веб-интерфейсы, сложен в интеграции с новыми системами, требует значительных ресурсов для обновления. | **Could have** |
| **Недостаточная масштабируемость для новых бизнесов** | Текущая система не готова к интеграции новых направлений (фармацевтика, электроника), что ограничивает рост компании. | Упущенные возможности для расширения, высокие затраты на доработку системы, задержки в запуске новых проектов. | Архитектура монолитна, шина и DWH не справляются с увеличением объема данных и интеграций, отсутствует событийно-ориентированная модель. | **Should have** |
| **Отсутствие обработки потоковых данных в реальном времени** | Данные обрабатываются с задержками, что мешает оперативно реагировать на изменения, например, в финансовых транзакциях или инвентаризации. | Потеря конкурентных преимуществ из-за отсутствия мгновенной аналитики, риск финансовых потерь из-за задержек. | Отсутствует платформа для потоковой обработки (например, Kafka), шина (Camel) работает в пакетном режиме, DWH не оптимизирован для реального времени. | **Could have** |
| **Слабая защита данных и соответствие требованиям конфиденциальности** | Нет строгого контроля доступа к данным, что увеличивает риск утечек, особенно для финансовых и персональных данных. | Штрафы за несоблюдение законов о защите данных, репутационные потери, недоверие клиентов. | Отсутствуют централизованные механизмы управления доступом и аудита. Хранилище метаданных не поддерживает детализированные политики безопасности. | **Must have** |
| **Отсутствие каталога данных** | Бизнес-пользователи и аналитики не знают, какие данные доступны и как их найти, что усложняет поиск нужной информации. | Увеличение времени на анализ данных, дублирование усилий аналитиков, низкая эффективность использования данных. | Нет единого каталога данных (аналог DataHub), метаданные разрознены, отсутствует поиск по данным и их описаниям. | **Could have** |

### Пояснения к приоритизации (MoSCoW)
- **Must have** (обязательно решить):
    - **Долгое время формирования отчетов**: Критично для оперативной аналитики, напрямую влияет на принятие решений. Реализация прототипа витрины (2 месяца) решает проблему.
    - **Устаревший DWH**: Основа системы, его низкая производительность и риски сбоев угрожают всей аналитике. Модернизация до SQL Server 2019 обязательна.
    - **Отсутствие портала самообслуживания**: Ключевая цель бизнеса — дать пользователям самостоятельный доступ к данным, снижая нагрузку на ИТ. Прототип витрины — первый шаг.
    - **Слабая защита данных**: Несоблюдение конфиденциальности влечет штрафы и репутационные потери, особенно для финансовых данных. Требует немедленного аудита и усиления контроля доступа.
- **Should have** (важно, но не срочно):
    - **Устаревшая интеграционная шина**: Важна для масштабирования и новых бизнесов, но замена на платформу (Kafka) требует 6–9 месяцев, поэтому откладывается до финального состояния.
    - **Недостаточная масштабируемость**: Связана с шиной и архитектурой, решается в финальном состоянии через новую платформу, но не критично для промежуточного этапа.
- **Could have** (желательно, но необязательно):
    - **Ограниченное управление метаданными**: Улучшит аналитику, но не срочно, так как базовые метаданные уже есть. Полное решение (каталог данных) возможно в финальном состоянии.
    - **Устаревший клиентский интерфейс**: Влияет на операционные процессы, но замена Power Builder требует значительных ресурсов и переобучения, что выходит за год.
    - **Отсутствие потоковой обработки**: Полезно для финтеха, но не критично для текущих процессов, которые справляются с пакетной обработкой. Реализуется в финальном состоянии (Kafka).
    - **Отсутствие каталога данных**: Упрощает поиск данных, но не является приоритетом, так как аналитики могут работать с текущими метаданными. Реализуется позже.

### Обоснования
- **Критерии приоритизации**:
    - **Влияние на бизнес**: Проблемы с высоким риском (штрафы, потери, задержки решений) — Must have.
    - **Срочность**: Проблемы, решаемые в промежуточном состоянии (2 месяца, например, прототип витрины), — Must have.
    - **Сложность и сроки**: Долгосрочные задачи (замена шины, масштабируемость) — Should have или Could have.
    - **Соответствие целям**: Оперативная аналитика, конфиденциальность, снижение нагрузки на ИТ — приоритетны.
- **Соответствие контексту**: Проблемы привязаны к текущей архитектуре (DWH, Camel, Power BI) и бизнес-целям (аналитика, новые бизнесы). Must have задачи решают ключевые боли (отчеты, защита данных), Should have поддерживают рост, Could have улучшают эффективность.
- **Понятность**: Приоритеты объясняют, почему проблема критична (например, «штрафы за утечки») или отложена (например, «замена шины требует 6–9 месяцев»).

